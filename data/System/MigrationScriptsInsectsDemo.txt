%META:TOPICPARENT{name="MigrationScriptsContrib"}%
---+ Topic-per-row import of a (large, ~160,000 row) CSV file into Foswiki

---++ Ingredients
   * CSV file [[%ATTACHURLPATH%/Insecta.csv]] (downloaded from [[http://www.environment.gov.au/biodiversity/abrs/online-resources/fauna/afd-data/insecta.zip][here]] at the [[http://www.environment.gov.au/biodiversity/abrs/online-resources/fauna/index.html][Australian Faunal Directory]] by running the =tools/MigrationScriptsContrib/InsectsDemo.pm= script)
   * [[%WEB%/%TOPIC%/InsectsForm]] to handle the columns in the CSV (generated by the !InsectsDemo script)
   * Import script =tools/MigrationScriptsContrib/InsectsDemo.pm=

---++ Recipe
   1 Run the script
   1 Return to this page, you should see a search search result below:
   %INCLUDE{"%TOPIC%" section="prettyprint" query="form.name='%WEB%.%TOPIC%.InsectsDemoForm'" inweb="%WEB%/%TOPIC%" }%

<verbatim class="tml foswikiHidden">%STARTSECTION{"prettyprint"}%%SEARCH{
     "%query%"
     type="query"
     web="%inweb%"
     header="%SEARCH{
         "%query%"
         type="query"
         web="%inweb%"
         nonoise="on"
         limit="1"
         format="   | *Topic* | $percentINCLUDE{\"%TOPIC%\" section=\"header\" webtopic=\"$web.$topic\"}$percent |"
     }%"
     format="   | [[$web.$topic][$topic]] | $percentINCLUDE{\"%TOPIC%\" section=\"row\" webtopic=\"$web.$topic\"}$percent |"
}%%ENDSECTION{"prettyprint"}%%STARTSECTION{"row"}%%FORMAT{
    "%QUERY{"'%webtopic%'/fields[NOT lc(attr)=~'h'].name"}%"
    type="string"
    format="$percentQUERY{\"'%webtopic%'/$item\"}$percent"
    separator=" | "
}%%ENDSECTION{"row"}%%STARTSECTION{"header"}%%FORMAT{
    "%QUERY{"'%webtopic%'/fields[NOT lc(attr)=~'h'].name"}%"
    type="string"
    format=" *$item* "
    separator=" | "
}%%ENDSECTION{"header"}%</verbatim>
